dbname = "nba_games",
password = "Tygafe4*")
kawhi_4th_made=dbGetQuery(connection,"SELECT * FROM location WHERE quarter_shot = 4 AND made_shots_text LIKE '%Kawhi Leonard makes%'")
head(kawhi_4th_made)
plot(,kawhi_4th_made$made_shots_loc_left,kawhi_4th_made$made_shots_loc_top)
drv = dbDriver("PostgreSQL")
connection = dbConnect(drv,
port = "5432",
host = "safeatxx.cnj4vinpaowc.us-west-2.rds.amazonaws.com",
user = "superuser",
dbname = "nba_games",
password = "Tygafe4*")
kawhi_4th_made=dbGetQuery(connection,"SELECT * FROM location WHERE quarter_shot = 4 AND made_shots_text LIKE '%Kawhi Leonard makes%'")
head(kawhi_4th_made)
plot(kawhi_4th_made$made_shots_loc_left,kawhi_4th_made$made_shots_loc_top)
upload_game_data_to_db = function(games){
game_id = games$game_id
for(i in 1:length(game_id)){
play_by_play = readHTMLTable(paste0("http://www.espn.com/nba/playbyplay?gameId=",game_id[i]))
if(length(play_by_play)<5){
print(paste0(game_id, " : Game Hasnt Happened")
}
else{
print(paste0(game_id," : GAME HAS HAPPEN")
play_by_play[[2]]$quarter = 1
play_by_play[[3]]$quarter = 2
play_by_play[[4]]$quarter = 3
play_by_play[[5]]$quarter = 4
play_by_play = rbind(play_by_play[[2]],play_by_play[[3]],play_by_play[[4]],play_by_play[[5]])
play_by_play = play_by_play[-grep("time",play_by_play[,1]),]
play_by_play = cbind(play_by_play,game_id[i])
play_by_play = as.data.frame(play_by_play)
names(play_by_play) = c("time_game","team","play_detail","score","nada","quarter","game_id")
play_by_play$quarter = as.character(play_by_play$quarter)
play_by_play$game_id = as.character(play_by_play$game_id)
play_by_play$quarter = as.numeric(play_by_play$quarter)
play_by_play$game_id = as.numeric(play_by_play$game_id)
shot_chart = read_html(paste0("http://www.espn.com/nba/playbyplay?gameId=",game_id[i]))
made_shots_text = shot_chart %>% html_nodes(xpath ='//*[contains(concat( " ", @class, " " ), concat( " ", "made", " " ))]') %>% html_attr("data-text")
made_shots_loc = shot_chart %>% html_nodes(xpath ='//*[contains(concat( " ", @class, " " ), concat( " ", "made", " " ))]') %>% html_attr("style")
player_id = shot_chart %>% html_nodes(xpath ='//*[contains(concat( " ", @class, " " ), concat( " ", "made", " " ))]') %>% html_attr("data-shooter")
quarter_shot = shot_chart %>% html_nodes(xpath ='//*[contains(concat( " ", @class, " " ), concat( " ", "made", " " ))]') %>% html_attr("data-period")
made_shots_loc_top = sub(".*top:", "", made_shots_loc)
made_shots_loc_left = sub(".*left:", "", made_shots_loc)
made_shots_loc_top = gsub("%;","",made_shots_loc_top)
made_shots_loc_left = gsub("%.*","",made_shots_loc_left)
location_makes=cbind(made_shots_text,made_shots_loc_top,made_shots_loc_left,player_id,quarter_shot,game_id[i])
location_makes = as.data.frame(location_makes)
names(location_makes)[6]="game_id"
location_makes$made_shots_loc_top =as.character(location_makes$made_shots_loc_top)
location_makes$made_shots_loc_left =as.character(location_makes$made_shots_loc_left)
location_makes$player_id =as.character(location_makes$player_id)
location_makes$quarter_shot =as.character(location_makes$quarter_shot)
location_makes$game_id =as.character(location_makes$game_id)
location_makes$made_shots_loc_top =as.numeric(location_makes$made_shots_loc_top)
location_makes$made_shots_loc_left =as.numeric(location_makes$made_shots_loc_left)
location_makes$player_id =as.numeric(location_makes$player_id)
location_makes$quarter_shot =as.numeric(location_makes$quarter_shot)
location_makes$game_id =as.numeric(location_makes$game_id)
if(i == 1){
drv = dbDriver("PostgreSQL")
connection = dbConnect(drv,
port = "5432",
host = "safeatxx.cnj4vinpaowc.us-west-2.rds.amazonaws.com",
user = "superuser",
dbname = "nba_games",
password = "Tygafe4*")
dbWriteTable(connection, "location", value=location_makes,row.names=FALSE)
dbWriteTable(connection, "play_by_play", value=play_by_play,row.names=FALSE)
dbDisconnect(connection)
}
else{
drv = dbDriver("PostgreSQL")
connection = dbConnect(drv,
port = "5432",
host = "safeatxx.cnj4vinpaowc.us-west-2.rds.amazonaws.com",
user = "superuser",
dbname = "nba_games",
password = "Tygafe4*")
dbWriteTable(connection, "location", value=location_makes,append=TRUE,row.names=FALSE)
dbWriteTable(connection, "play_by_play", value=play_by_play,append=TRUE,row.names=FALSE)
dbDisconnect(connection)
}
}
}
}
upload_game_data_to_db = function(games){
game_id = games$game_id
for(i in 1:length(game_id)){
play_by_play = readHTMLTable(paste0("http://www.espn.com/nba/playbyplay?gameId=",game_id[i]))
if(length(play_by_play)<5){
print(paste0(game_id, " : Game Hasnt Happened"))
}
else{
print(paste0(game_id," : GAME HAS HAPPEN"))
play_by_play[[2]]$quarter = 1
play_by_play[[3]]$quarter = 2
play_by_play[[4]]$quarter = 3
play_by_play[[5]]$quarter = 4
play_by_play = rbind(play_by_play[[2]],play_by_play[[3]],play_by_play[[4]],play_by_play[[5]])
play_by_play = play_by_play[-grep("time",play_by_play[,1]),]
play_by_play = cbind(play_by_play,game_id[i])
play_by_play = as.data.frame(play_by_play)
names(play_by_play) = c("time_game","team","play_detail","score","nada","quarter","game_id")
play_by_play$quarter = as.character(play_by_play$quarter)
play_by_play$game_id = as.character(play_by_play$game_id)
play_by_play$quarter = as.numeric(play_by_play$quarter)
play_by_play$game_id = as.numeric(play_by_play$game_id)
shot_chart = read_html(paste0("http://www.espn.com/nba/playbyplay?gameId=",game_id[i]))
made_shots_text = shot_chart %>% html_nodes(xpath ='//*[contains(concat( " ", @class, " " ), concat( " ", "made", " " ))]') %>% html_attr("data-text")
made_shots_loc = shot_chart %>% html_nodes(xpath ='//*[contains(concat( " ", @class, " " ), concat( " ", "made", " " ))]') %>% html_attr("style")
player_id = shot_chart %>% html_nodes(xpath ='//*[contains(concat( " ", @class, " " ), concat( " ", "made", " " ))]') %>% html_attr("data-shooter")
quarter_shot = shot_chart %>% html_nodes(xpath ='//*[contains(concat( " ", @class, " " ), concat( " ", "made", " " ))]') %>% html_attr("data-period")
made_shots_loc_top = sub(".*top:", "", made_shots_loc)
made_shots_loc_left = sub(".*left:", "", made_shots_loc)
made_shots_loc_top = gsub("%;","",made_shots_loc_top)
made_shots_loc_left = gsub("%.*","",made_shots_loc_left)
location_makes=cbind(made_shots_text,made_shots_loc_top,made_shots_loc_left,player_id,quarter_shot,game_id[i])
location_makes = as.data.frame(location_makes)
names(location_makes)[6]="game_id"
location_makes$made_shots_loc_top =as.character(location_makes$made_shots_loc_top)
location_makes$made_shots_loc_left =as.character(location_makes$made_shots_loc_left)
location_makes$player_id =as.character(location_makes$player_id)
location_makes$quarter_shot =as.character(location_makes$quarter_shot)
location_makes$game_id =as.character(location_makes$game_id)
location_makes$made_shots_loc_top =as.numeric(location_makes$made_shots_loc_top)
location_makes$made_shots_loc_left =as.numeric(location_makes$made_shots_loc_left)
location_makes$player_id =as.numeric(location_makes$player_id)
location_makes$quarter_shot =as.numeric(location_makes$quarter_shot)
location_makes$game_id =as.numeric(location_makes$game_id)
if(i == 1){
drv = dbDriver("PostgreSQL")
connection = dbConnect(drv,
port = "5432",
host = "safeatxx.cnj4vinpaowc.us-west-2.rds.amazonaws.com",
user = "superuser",
dbname = "nba_games",
password = "Tygafe4*")
dbWriteTable(connection, "location", value=location_makes,row.names=FALSE)
dbWriteTable(connection, "play_by_play", value=play_by_play,row.names=FALSE)
dbDisconnect(connection)
}
else{
drv = dbDriver("PostgreSQL")
connection = dbConnect(drv,
port = "5432",
host = "safeatxx.cnj4vinpaowc.us-west-2.rds.amazonaws.com",
user = "superuser",
dbname = "nba_games",
password = "Tygafe4*")
dbWriteTable(connection, "location", value=location_makes,append=TRUE,row.names=FALSE)
dbWriteTable(connection, "play_by_play", value=play_by_play,append=TRUE,row.names=FALSE)
dbDisconnect(connection)
}
}
}
}
upload_game_data_to_db(full_games_clean)
upload_game_data_to_db = function(games){
game_id = games$game_id
for(i in 1:length(game_id)){
play_by_play = readHTMLTable(paste0("http://www.espn.com/nba/playbyplay?gameId=",game_id[i]))
if(length(play_by_play)<5){
print(paste0(game_id[i], " : Game Hasnt Happened"))
}
else{
print(paste0(game_id[i]," : GAME HAS HAPPEN"))
play_by_play[[2]]$quarter = 1
play_by_play[[3]]$quarter = 2
play_by_play[[4]]$quarter = 3
play_by_play[[5]]$quarter = 4
play_by_play = rbind(play_by_play[[2]],play_by_play[[3]],play_by_play[[4]],play_by_play[[5]])
play_by_play = play_by_play[-grep("time",play_by_play[,1]),]
play_by_play = cbind(play_by_play,game_id[i])
play_by_play = as.data.frame(play_by_play)
names(play_by_play) = c("time_game","team","play_detail","score","nada","quarter","game_id")
play_by_play$quarter = as.character(play_by_play$quarter)
play_by_play$game_id = as.character(play_by_play$game_id)
play_by_play$quarter = as.numeric(play_by_play$quarter)
play_by_play$game_id = as.numeric(play_by_play$game_id)
shot_chart = read_html(paste0("http://www.espn.com/nba/playbyplay?gameId=",game_id[i]))
made_shots_text = shot_chart %>% html_nodes(xpath ='//*[contains(concat( " ", @class, " " ), concat( " ", "made", " " ))]') %>% html_attr("data-text")
made_shots_loc = shot_chart %>% html_nodes(xpath ='//*[contains(concat( " ", @class, " " ), concat( " ", "made", " " ))]') %>% html_attr("style")
player_id = shot_chart %>% html_nodes(xpath ='//*[contains(concat( " ", @class, " " ), concat( " ", "made", " " ))]') %>% html_attr("data-shooter")
quarter_shot = shot_chart %>% html_nodes(xpath ='//*[contains(concat( " ", @class, " " ), concat( " ", "made", " " ))]') %>% html_attr("data-period")
made_shots_loc_top = sub(".*top:", "", made_shots_loc)
made_shots_loc_left = sub(".*left:", "", made_shots_loc)
made_shots_loc_top = gsub("%;","",made_shots_loc_top)
made_shots_loc_left = gsub("%.*","",made_shots_loc_left)
location_makes=cbind(made_shots_text,made_shots_loc_top,made_shots_loc_left,player_id,quarter_shot,game_id[i])
location_makes = as.data.frame(location_makes)
names(location_makes)[6]="game_id"
location_makes$made_shots_loc_top =as.character(location_makes$made_shots_loc_top)
location_makes$made_shots_loc_left =as.character(location_makes$made_shots_loc_left)
location_makes$player_id =as.character(location_makes$player_id)
location_makes$quarter_shot =as.character(location_makes$quarter_shot)
location_makes$game_id =as.character(location_makes$game_id)
location_makes$made_shots_loc_top =as.numeric(location_makes$made_shots_loc_top)
location_makes$made_shots_loc_left =as.numeric(location_makes$made_shots_loc_left)
location_makes$player_id =as.numeric(location_makes$player_id)
location_makes$quarter_shot =as.numeric(location_makes$quarter_shot)
location_makes$game_id =as.numeric(location_makes$game_id)
if(i == 1){
drv = dbDriver("PostgreSQL")
connection = dbConnect(drv,
port = "5432",
host = "safeatxx.cnj4vinpaowc.us-west-2.rds.amazonaws.com",
user = "superuser",
dbname = "nba_games",
password = "Tygafe4*")
dbWriteTable(connection, "location", value=location_makes,row.names=FALSE)
dbWriteTable(connection, "play_by_play", value=play_by_play,row.names=FALSE)
dbDisconnect(connection)
}
else{
drv = dbDriver("PostgreSQL")
connection = dbConnect(drv,
port = "5432",
host = "safeatxx.cnj4vinpaowc.us-west-2.rds.amazonaws.com",
user = "superuser",
dbname = "nba_games",
password = "Tygafe4*")
dbWriteTable(connection, "location", value=location_makes,append=TRUE,row.names=FALSE)
dbWriteTable(connection, "play_by_play", value=play_by_play,append=TRUE,row.names=FALSE)
dbDisconnect(connection)
}
}
}
}
dbDisconnect(connection)
library(XML)
library(MASS)
library(RPostgreSQL)
library(rvest)
get_game_data = function(games){
game_id = games$game_id
for(i in 1:length(game_id) ){
game_date = read_html(paste0("http://www.espn.com/nba/game?gameId=",game_id[i]))
team=game_date %>% html_nodes(xpath ='//*[contains(concat( " ", @class, " " ), concat( " ", "short-name", " " ))]') %>% html_text()
team=team[1:2]
date=game_date %>% html_nodes(xpath ='//*[@id="gamepackage-game-information"]/article/div/div[1]/div/div[1]/span') %>% html_attr("data-date")
date=gsub("T.+","",date)
home_away = c("A","H")
game_info=as.data.frame(cbind(game_id[i],team,home_away,date))
names(game_info)[1]="game_id"
game_info$game_id = as.character(game_info$game_id)
game_info$date = as.character(game_info$date)
game_info$game_id = as.numeric(game_info$game_id)
game_info$date = as.Date(game_info$date)-1
if(i == 1){
drv = dbDriver("PostgreSQL")
connection = dbConnect(drv,
port = "5432",
host = "safeatxx.cnj4vinpaowc.us-west-2.rds.amazonaws.com",
user = "superuser",
dbname = "nba_games",
password = "Tygafe4*")
dbWriteTable(connection, "game_info", value=game_info,append=TRUE,row.names=FALSE)
dbDisconnect(connection)
}
else{
drv = dbDriver("PostgreSQL")
connection = dbConnect(drv,
port = "5432",
host = "safeatxx.cnj4vinpaowc.us-west-2.rds.amazonaws.com",
user = "superuser",
dbname = "nba_games",
password = "Tygafe4*")
dbWriteTable(connection, "game_info", value=game_info,append=TRUE,row.names=FALSE)
dbDisconnect(connection)
}
}
}
##get play by play data for each game
upload_game_data_to_db = function(games){
game_id = games$game_id
for(i in 1:length(game_id)){
play_by_play = readHTMLTable(paste0("http://www.espn.com/nba/playbyplay?gameId=",game_id[i]))
if(length(play_by_play)<5){
print(paste0(game_id[i], " : Game Hasnt Happened"))
}
else{
print(paste0(game_id[i]," : GAME HAS HAPPEN"))
play_by_play[[2]]$quarter = 1
play_by_play[[3]]$quarter = 2
play_by_play[[4]]$quarter = 3
play_by_play[[5]]$quarter = 4
play_by_play = rbind(play_by_play[[2]],play_by_play[[3]],play_by_play[[4]],play_by_play[[5]])
play_by_play = play_by_play[-grep("time",play_by_play[,1]),]
play_by_play = cbind(play_by_play,game_id[i])
play_by_play = as.data.frame(play_by_play)
names(play_by_play) = c("time_game","team","play_detail","score","nada","quarter","game_id")
play_by_play$quarter = as.character(play_by_play$quarter)
play_by_play$game_id = as.character(play_by_play$game_id)
play_by_play$quarter = as.numeric(play_by_play$quarter)
play_by_play$game_id = as.numeric(play_by_play$game_id)
shot_chart = read_html(paste0("http://www.espn.com/nba/playbyplay?gameId=",game_id[i]))
##get missed data
made_shots_text = shot_chart %>% html_nodes(xpath ='//*[contains(concat( " ", @class, " " ), concat( " ", "made", " " ))]') %>% html_attr("data-text")
made_shots_loc = shot_chart %>% html_nodes(xpath ='//*[contains(concat( " ", @class, " " ), concat( " ", "made", " " ))]') %>% html_attr("style")
player_id = shot_chart %>% html_nodes(xpath ='//*[contains(concat( " ", @class, " " ), concat( " ", "made", " " ))]') %>% html_attr("data-shooter")
quarter_shot = shot_chart %>% html_nodes(xpath ='//*[contains(concat( " ", @class, " " ), concat( " ", "made", " " ))]') %>% html_attr("data-period")
made_shots_loc_top = sub(".*top:", "", made_shots_loc)
made_shots_loc_left = sub(".*left:", "", made_shots_loc)
made_shots_loc_top = gsub("%;","",made_shots_loc_top)
made_shots_loc_left = gsub("%.*","",made_shots_loc_left)
location_makes=cbind(made_shots_text,made_shots_loc_top,made_shots_loc_left,player_id,quarter_shot,game_id[i])
location_makes = as.data.frame(location_makes)
names(location_makes)[6]="game_id"
location_makes$made_shots_loc_top =as.character(location_makes$made_shots_loc_top)
location_makes$made_shots_loc_left =as.character(location_makes$made_shots_loc_left)
location_makes$player_id =as.character(location_makes$player_id)
location_makes$quarter_shot =as.character(location_makes$quarter_shot)
location_makes$game_id =as.character(location_makes$game_id)
location_makes$made_shots_loc_top =as.numeric(location_makes$made_shots_loc_top)
location_makes$made_shots_loc_left =as.numeric(location_makes$made_shots_loc_left)
location_makes$player_id =as.numeric(location_makes$player_id)
location_makes$quarter_shot =as.numeric(location_makes$quarter_shot)
location_makes$game_id =as.numeric(location_makes$game_id)
if(i == 1){
drv = dbDriver("PostgreSQL")
connection = dbConnect(drv,
port = "5432",
host = "safeatxx.cnj4vinpaowc.us-west-2.rds.amazonaws.com",
user = "superuser",
dbname = "nba_games",
password = "Tygafe4*")
dbWriteTable(connection, "location", value=location_makes,append=TRUE,row.names=FALSE)
dbWriteTable(connection, "play_by_play", value=play_by_play,append=TRUE,row.names=FALSE)
dbDisconnect(connection)
}
else{
drv = dbDriver("PostgreSQL")
connection = dbConnect(drv,
port = "5432",
host = "safeatxx.cnj4vinpaowc.us-west-2.rds.amazonaws.com",
user = "superuser",
dbname = "nba_games",
password = "Tygafe4*")
dbWriteTable(connection, "location", value=location_makes,append=TRUE,row.names=FALSE)
dbWriteTable(connection, "play_by_play", value=play_by_play,append=TRUE,row.names=FALSE)
dbDisconnect(connection)
}
}
}
}
get_player_info =function(images){
image_id=images$id
for(i in 1:length(image_id)){
player_info = read_html(paste0("http://www.espn.com/nba/player/_/id/",image_id[i]))
player_team = player_info %>% html_nodes(xpath='//*[@id="content"]/div[3]/div[2]/div[3]/ul[1]/li[3]/a') %>% html_text()
if(length(player_team)==0){
player_team = "None"
}
player_information = as.data.frame(cbind(image_id[i],player_team,as.character(images$player[i])))
names(player_information)=c("player_id","player_team","player_name")
player_information$player_id = as.character(player_information$player_id)
player_information$player_name = as.character(player_information$player_name)
player_information$player_id = as.numeric(player_information$player_id)
if(i == 1){
drv = dbDriver("PostgreSQL")
connection = dbConnect(drv,
port = "5432",
host = "safeatxx.cnj4vinpaowc.us-west-2.rds.amazonaws.com",
user = "superuser",
dbname = "nba_games",
password = "Tygafe4*")
dbWriteTable(connection, "player_information", value=player_information,row.names=FALSE)
dbDisconnect(connection)
}
else{
drv = dbDriver("PostgreSQL")
connection = dbConnect(drv,
port = "5432",
host = "safeatxx.cnj4vinpaowc.us-west-2.rds.amazonaws.com",
user = "superuser",
dbname = "nba_games",
password = "Tygafe4*")
dbWriteTable(connection, "player_information", value=player_information,append=TRUE,row.names=FALSE)
dbDisconnect(connection)
}
}
}
upload_misses_to_db = function(games){
game_id = games$game_id
for(i in 1:length(game_id)){
play_by_play = readHTMLTable(paste0("http://www.espn.com/nba/playbyplay?gameId=",game_id[i]))
if(length(play_by_play)<5){
print(paste0(game_id[i], " : Game Hasnt Happened"))
}
else{
print(paste0(game_id[i]," : GAME HAS HAPPEN"))
shot_chart = read_html(paste0("http://www.espn.com/nba/playbyplay?gameId=",game_id[i]))
##get missed data
made_shots_text = shot_chart %>% html_nodes(xpath ='//*[contains(concat( " ", @class, " " ), concat( " ", "missed", " " ))]') %>% html_attr("data-text")
made_shots_loc = shot_chart %>% html_nodes(xpath ='//*[contains(concat( " ", @class, " " ), concat( " ", "missed", " " ))]') %>% html_attr("style")
player_id = shot_chart %>% html_nodes(xpath ='//*[contains(concat( " ", @class, " " ), concat( " ", "missed", " " ))]') %>% html_attr("data-shooter")
quarter_shot = shot_chart %>% html_nodes(xpath ='//*[contains(concat( " ", @class, " " ), concat( " ", "missed", " " ))]') %>% html_attr("data-period")
missed_shot_loc_top = sub(".*top:", "", made_shots_loc)
missed_shot_loc_left = sub(".*left:", "", made_shots_loc)
missed_shot_loc_top = gsub("%;","",missed_shot_loc_top)
missed_shot_loc_left = gsub("%.*","",missed_shot_loc_left)
location_misses=cbind(made_shots_text,missed_shot_loc_top,missed_shot_loc_left,player_id,quarter_shot,game_id[i])
location_misses = as.data.frame(location_misses)
names(location_misses)[6]="game_id"
location_misses$missed_shot_loc_top =as.character(location_misses$missed_shot_loc_top)
location_misses$missed_shot_loc_left =as.character(location_misses$missed_shot_loc_left)
location_misses$player_id =as.character(location_misses$player_id)
location_misses$quarter_shot =as.character(location_misses$quarter_shot)
location_misses$game_id =as.character(location_misses$game_id)
location_misses$missed_shot_loc_top =as.numeric(location_misses$missed_shot_loc_top)
location_misses$missed_shot_loc_left =as.numeric(location_misses$missed_shot_loc_left)
location_misses$player_id =as.numeric(location_misses$player_id)
location_misses$quarter_shot =as.numeric(location_misses$quarter_shot)
location_misses$game_id =as.numeric(location_misses$game_id)
if(i == 1){
drv = dbDriver("PostgreSQL")
connection = dbConnect(drv,
port = "5432",
host = "safeatxx.cnj4vinpaowc.us-west-2.rds.amazonaws.com",
user = "superuser",
dbname = "nba_games",
password = "Tygafe4*")
dbWriteTable(connection, "location_misses", value=location_misses,append=TRUE,row.names=FALSE)
dbDisconnect(connection)
}
else{
drv = dbDriver("PostgreSQL")
connection = dbConnect(drv,
port = "5432",
host = "safeatxx.cnj4vinpaowc.us-west-2.rds.amazonaws.com",
user = "superuser",
dbname = "nba_games",
password = "Tygafe4*")
dbWriteTable(connection, "location_misses", value=location_misses,append=TRUE,row.names=FALSE)
dbDisconnect(connection)
}
}
}
}
drv = dbDriver("PostgreSQL")
connection = dbConnect(drv,
port = "5432",
host = "safeatxx.cnj4vinpaowc.us-west-2.rds.amazonaws.com",
user = "superuser",
dbname = "nba_games",
password = "Tygafe4*")
unique_games=dbGetQuery(connection, "SELECT DISTINCT game_id FROM location ")
unique_players=dbGetQuery(connection, "SELECT DISTINCT player_id FROM player_information")
unique_games_2 = dbGetQuery(connection,"SELECT DISTINCT game_id FROM game_info")
Sys.Date()
games_already_not_game_data= dbGetQuery(connection, paste0("SELECT game_info.game_id,game_info.date FROM game_info
LEFT JOIN location ON location.game_id=game_info.game_id WHERE location.game_id IS NULL
AND game_info.date <='",Sys.Date()-1,"' GROUP BY game_info.game_id,game_info.date ORDER BY game_info.date"))
uniques=subset(unique_games,(game_id %in% unique_games_2$game_id))
games_already_not_game_data_miss= dbGetQuery(connection, paste0("SELECT game_info.game_id,game_info.date FROM game_info
LEFT JOIN location_misses ON location_misses.game_id=game_info.game_id WHERE location_misses.game_id IS NULL
AND game_info.date <='",Sys.Date()-1,"' GROUP BY game_info.game_id,game_info.date ORDER BY game_info.date"))
dbDisconnect(connection)
images_data =read.csv("~/Desktop/nba_shinyapp/images_players.csv")
images = subset(images_data, !( id %in% unique_players$player_id ))
full_games = data.frame(games=(character()))
days = seq(as.Date('2017-02-04'),as.Date(Sys.Date()),by='day')
for(i in seq_along(days)){
date=format(days[i],format="%Y%m%d")
games = read_html(paste0("http://www.espn.com/nba/schedule/_/date/",date))
games = games %>% html_nodes(xpath="//td/a") %>% html_attr("href")
games = as.data.frame(games)
games[,1] = as.character(games[,1])
games = games[grep("gameId",games[,1]),]
games = gsub("\\/nba\\/game\\?gameId=","",games)
games = as.data.frame(games)
games[,1] = as.character(games[,1])
full_games = rbind(games,full_games)
}
full_games_clean = full_games[!duplicated(full_games[,1]),]
full_games_clean = as.data.frame(full_games_clean)
full_games_clean = full_games_clean[-grep("http",full_games_clean[,1]),]
full_games_clean = as.data.frame(full_games_clean)
names(full_games_clean) = "game_id"
full_games_clean$game_id = as.character(full_games_clean$game_id)
full_games_clean = as.data.frame(full_games_clean)
full_games_clean = subset(full_games_clean, !(game_id %in% uniques$game_id))
upload_new_games = subset(full_games_clean,!(game_id %in%games_already_not_game_data$game_id))
upload_game_data_to_db(full_games_clean)
upload_misses_to_db(games_already_not_game_data_miss)
games_already_not_game_data_miss
setwd("Desktop/onefourty/")
library(shiny)
runApp()
runApp()
library(tm,,quietly = TRUE)
library(wordcloud,,quietly = TRUE)
library(e1071,,quietly = TRUE)
library(dplyr,,quietly = TRUE)
library(caret,,quietly = TRUE)
library(doMC,,quietly = TRUE)
library(xml2,,quietly = TRUE)
library(rvest,,quietly = TRUE)
library(shiny)
library(shinythemes)
library(shinysky)
library(ggthemes)
library(plotly)
load("final_list_subjects_dtm.RData")
list_names=do.call(rbind.data.frame, lapply(final_list,function(x){x[[11]]}))
list_names[,1]=as.character(list_names[,1])
probs=do.call(cbind.data.frame, lapply(final_list,function(x){x[[9]]}))
probs
runApp()
runApp()
runApp()
